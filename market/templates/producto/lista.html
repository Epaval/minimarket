{% extends "producto/base_producto.html" %}
{% load static %}

{% block panel-content %}
<div class="grid-x grid-margin-x align-center" style="padding: 1.5rem 0;">
  <!-- Búsqueda y botón de registro -->
  <div class="cell large-8 medium-10 small-12 grid-x grid-margin-x align-middle" style="margin-bottom: 1.5rem;">
    <div class="cell large-9 medium-8 small-12">
      <form class="input-group" method="GET">
        <span class="input-group-label" style="background: #6d28d9; color: white; font-weight: 600;">
          <i class="fi-barcode"></i>
        </span>
        <input class="input-group-field" 
               type="text" 
               id="kword" 
               name="kword" 
               placeholder="Buscar por nombre o código..." 
               value="{{ request.GET.kword|default:'' }}"
               style="border-radius: 0 0.375rem 0.375rem 0;">
        <div class="input-group-button">
          <input type="submit" class="button primary gradient-purple" value="Buscar">
        </div>
      </form>
    </div>
    <div class="cell large-3 medium-4 small-12 text-center">
      <a href="{% url 'producto_app:producto-add' %}" 
         class="button success expanded" 
         style="font-weight: 600; border-radius: 0.5rem; box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);">
        <i class="fi-plus"></i> Nuevo Producto
      </a>
    </div>
  </div>

  <!-- Filtros de orden -->
  <div class="cell large-8 medium-10 small-12 grid-x grid-padding-x" style="margin-bottom: 2rem; text-align: center;">
    <div class="cell large-4 medium-4 small-12">
      <a href="?order=name" class="button hollow {% if request.GET.order == 'name' %}primary active{% endif %} radius" style="width: 100%;">
        <i class="fi-sort-alpha-asc"></i> Ordenar por Nombre
      </a>
    </div>
    <div class="cell large-4 medium-4 small-12">
      <a href="?order=date" class="button hollow {% if request.GET.order == 'date' %}primary active{% endif %} radius" style="width: 100%;">
        <i class="fi-calendar"></i> Por Fecha
      </a>
    </div>
    <div class="cell large-4 medium-4 small-12">
      <a href="?order=stok" class="button hollow {% if request.GET.order == 'stok' %}primary active{% endif %} radius" style="width: 100%;">
        <i class="fi-graph-bar"></i> Por Stock
      </a>
    </div>
  </div>

  <!-- Tabla de productos -->
  <div class="cell large-10 medium-12 small-12">
    <div class="callout primary" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.5rem; box-shadow: 0 4px 16px rgba(0,0,0,0.05);">
      <table class="hover stack" style="border-collapse: collapse; width: 100%;">
        <thead style="background: #6d28d9; color: white;">
          <tr>
            <th style="padding: 1rem; border-top-left-radius: 0.5rem;">CÓDIGO</th>
            <th>NOMBRE</th>
            <th>PRECIO VENTA</th>
            <th>PRECIO COMPRA</th>
            <th>STOCK</th>
            <th>VENTAS</th>
            <th style="border-top-right-radius: 0.5rem;">ACCIONES</th>
          </tr>
        </thead>
        <tbody>
          {% for producto in productos %}
            <tr style="transition: background 0.2s ease; border-bottom: 1px solid #e2e8f0;">
              <td style="padding: 1rem; color: #475569;">{{ producto.barcode|default:'—' }}</td>
              <td style="color: #1e293b; font-weight: 500;">{{ producto.name }}</td>
              <td style="color: #059669; font-weight: 600;">S/ {{ producto.sale_price }}</td>
              <td style="color: #dc2626; font-weight: 500;">S/ {{ producto.purchase_price }}</td>
              <td>
                <span class="badge {% if producto.count <= 5 %}alert{% elif producto.count <= 10 %}warning{% else %}success{% endif %}"
                      style="padding: 0.4rem 0.6rem; border-radius: 9999px; font-size: 0.85rem;">
                  {{ producto.count }}
                </span>
              </td>
              <td style="color: #64748b;">{{ producto.num_sale }}</td>
              <td class="text-center">
                <div class="button-group compact">
                  <a href="{% url 'producto_app:producto-update' producto.id %}" 
                     class="button warning tiny" 
                     style="border-radius: 50%; padding: 0.6rem; box-shadow: 0 2px 5px rgba(234, 179, 8, 0.3);"
                     data-tooltip aria-haspopup="true" title="Editar producto">
                    <i class="fi-pencil" style="color: white;"></i>
                  </a>
                  <a href="{% url 'producto_app:producto-detail' producto.id %}" 
                     class="button info tiny" 
                     style="border-radius: 50%; padding: 0.6rem; box-shadow: 0 2px 5px rgba(37, 99, 235, 0.3);"
                     data-tooltip aria-haspopup="true" title="Ver detalles">
                    <i class="fi-eye" style="color: white;"></i>
                  </a>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="text-center" style="padding: 2rem; color: #64748b; font-style: italic;">
                <i class="fi-page-search" style="font-size: 2rem; margin-bottom: 0.5rem;"></i><br>
                No se encontraron productos.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Estilos personalizados (opcional: puedes moverlo a un archivo CSS) -->
<style>
  .gradient-purple {
    background: linear-gradient(90deg, #8b5cf6, #6d28d9);
    border: none;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  .gradient-purple:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 14px rgba(109, 40, 217, 0.4);
  }
  .button.active {
    background: #6d28d9 !important;
    color: white !important;
    font-weight: 600;
  }
  .badge {
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.3rem 0.6rem;
  }
  [data-tooltip] {
    cursor: help;
  }
  table th {
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.85rem;
  }
  table td {
    vertical-align: middle;
  }
</style>

{% endblock panel-content %}